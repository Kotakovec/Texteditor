<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jednoduchý Word s Popup Editorem</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  .toolbar {
    background: #f0f0f0;
    padding: 10px;
    display: none; /* schovaný dokud není editmode */
    gap: 5px;
    flex-wrap: wrap;
  }
  .toolbar button, .toolbar select {
    padding: 5px;
  }
  #editor {
    flex: 1;
    padding: 20px;
    border: none;
    outline: none;
    overflow-y: auto;
    background: #fff;
    font-family: Arial, sans-serif;
    white-space: pre-wrap;
  }
  .code-block {
    background: #1e1e1e;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    padding: 10px;
    display: flex;
    gap: 10px;
  }
  .line-numbers {
    text-align: right;
    user-select: none;
    color: #888;
  }
  .code-content {
    white-space: pre;
  }
</style>
</head>
<body>

<div class="toolbar" id="toolbar">
  <button onclick="format('bold')"><b>B</b></button>
  <button onclick="format('underline')"><u>U</u></button>
  <select onchange="format('fontName', this.value)">
    <option value="">Font</option>
    <option value="Arial">Klasický</option>
    <option value="Courier New">Linux Terminal</option>
    <option value="monospace">Monospace</option>
  </select>
  <select onchange="format('fontSize', this.value)">
    <option value="">Velikost textu</option>
    <option value="1">10px</option>
    <option value="2">13px</option>
    <option value="3">16px</option>
    <option value="4">18px</option>
    <option value="5">24px</option>
    <option value="6">32px</option>
    <option value="7">48px</option>
  </select>
  <select onchange="format('foreColor', this.value)">
    <option value="">Barva textu</option>
    <option value="red">Červená</option>
    <option value="blue">Modrá</option>
    <option value="green">Zelená</option>
    <option value="black">Černá</option>
  </select>
  <button onclick="format('insertUnorderedList')">• List</button>
  <button onclick="format('insertOrderedList')">1. List</button>
  <button onclick="insertCode()">Vložit kód</button>
  <button onclick="openPopupEditor()">Otevřít nové okno</button>
</div>

<div id="editor" contenteditable="false"></div>

<script>
const editor = document.getElementById('editor');
const toolbar = document.getElementById('toolbar');

// Načtení textu
window.onload = () => {
  const saved = localStorage.getItem('myWordContent');
  if(saved) editor.innerHTML = saved;
};

// Formátování
function format(command, value = null) {
  if(!editor.isContentEditable) return;
  document.execCommand(command, false, value);
  saveText();
}

// Automatické ukládání
editor.addEventListener('input', () => {
  if(editor.isContentEditable) saveText();
});
editor.addEventListener('keydown', handleKeys);

// Enter a Tab
function handleKeys(e) {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '<br><br>');
    saveText();
  }
  if(e.key === 'Tab') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    saveText();
  }
}

// Uložení
function saveText() {
  localStorage.setItem('myWordContent', editor.innerHTML);
}

// Tajný edit mode
window.editmode = () => {
  editor.setAttribute('contenteditable', 'true');
  toolbar.style.display = 'flex';
};

// Ctrl+E na zapnutí editmode
document.addEventListener('keydown', (e) => {
  if(e.ctrlKey && e.key.toLowerCase() === 'e') {
    e.preventDefault();
    editmode();
  }
});

// Vložení kódu
function insertCode() {
  if(!editor.isContentEditable) return;
  const code = prompt("Vlož sem svůj kód:");
  if(!code) return;
  const lines = code.split('\n');
  const lineNumbers = lines.map((_, i) => i + 1).join('<br>');
  const codeHTML = `
    <div class="code-block">
      <div class="line-numbers">${lineNumbers}</div>
      <div class="code-content">${lines.join('<br>')}</div>
    </div><br>
  `;
  editor.innerHTML += codeHTML;
  saveText();
}

// Otevření nového okna s editorem
function openPopupEditor() {
  const popup = window.open("", "_blank", "width=800,height=600");
  popup.document.write(`
    <!DOCTYPE html>
    <html lang="cs">
    <head>
    <meta charset="UTF-8">
    <title>Popup Editor</title>
    <style>
      body { margin:0; display:flex; flex-direction:column; height:100vh; font-family:Arial,sans-serif; }
      .toolbar { background:#f0f0f0; padding:10px; display:flex; gap:5px; flex-wrap:wrap; }
      #popupEditor { flex:1; padding:20px; outline:none; border:none; overflow-y:auto; background:#fff; white-space:pre-wrap; }
      .code-block { background:#1e1e1e; color:#d4d4d4; font-family:'Courier New', monospace; padding:10px; display:flex; gap:10px; }
      .line-numbers { text-align:right; user-select:none; color:#888; }
      .code-content { white-space:pre; }
    </style>
    </head>
    <body>
      <div class="toolbar">
        <button onclick="format('bold')"><b>B</b></button>
        <button onclick="format('underline')"><u>U</u></button>
        <select onchange="format('fontName', this.value)">
          <option value="">Font</option>
          <option value="Arial">Klasický</option>
          <option value="Courier New">Linux Terminal</option>
          <option value="monospace">Monospace</option>
        </select>
        <select onchange="format('fontSize', this.value)">
          <option value="">Velikost textu</option>
          <option value="1">10px</option>
          <option value="2">13px</option>
          <option value="3">16px</option>
          <option value="4">18px</option>
          <option value="5">24px</option>
          <option value="6">32px</option>
          <option value="7">48px</option>
        </select>
        <button onclick="insertCode()">Vložit kód</button>
      </div>
      <div id="popupEditor" contenteditable="true"></div>
      <script>
        const editor = document.getElementById('popupEditor');
        window.onload = () => {
          const saved = localStorage.getItem('popupEditorContent');
          if(saved) editor.innerHTML = saved;
        };
        function format(cmd, value=null){ document.execCommand(cmd,false,value); saveText(); }
        function saveText(){ localStorage.setItem('popupEditorContent', editor.innerHTML); }
        editor.addEventListener('input', saveText);
        editor.addEventListener('keydown', (e)=> {
          if(e.key==='Enter'){ e.preventDefault(); document.execCommand('insertHTML',false,'<br><br>'); saveText(); }
          if(e.key==='Tab'){ e.preventDefault(); document.execCommand('insertHTML',false,'&nbsp;&nbsp;&nbsp;&nbsp;'); saveText(); }
        });
        function insertCode(){
          const code = prompt("Vlož kód:");
          if(!code) return;
          const lines = code.split('\\n');
          const nums = lines.map((_,i)=>i+1).join('<br>');
          const codeHTML = \`
            <div class="code-block">
              <div class="line-numbers">\${nums}</div>
              <div class="code-content">\${lines.join('<br>')}</div>
            </div><br>
          \`;
          editor.innerHTML += codeHTML;
          saveText();
        }
      </script>
    </body>
    </html>
  `);
}
</script>

</body>
</html>