<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor bez toolbaru</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; background:#000; color:#fff; }
  #editor { flex:1; padding:20px; border:none; outline:none; overflow-y:auto; background:#111; font-family:Arial, sans-serif; white-space:pre-wrap; color:#fff; }
  .code-block { background:#1e1e1e; color:#d4d4d4; font-family:'Courier New', monospace; padding:10px; display:flex; gap:10px; }
  .line-numbers { text-align:right; user-select:none; color:#888; }
  .code-content { white-space:pre; }
  .modal { display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; background:#111; border:2px solid #fff; z-index:1000; flex-direction:column; border-radius:25px; }
  .modal-header { background:#222; padding:5px; display:flex; justify-content:space-between; align-items:center; color:#fff; border-radius:30px; }
  .modal-body { flex:1; padding:10px; overflow-y:auto; border-top:1px solid #555; color:#fff; }
  .close-btn { cursor:pointer; font-weight:bold; }
  .doc-btn { padding:5px 10px; margin:5px; cursor:pointer; color:#fff; background:#000; border-radius:25px; }
</style>
</head>
<body>

<div id="editor" contenteditable="false"></div>

<div class="modal" id="modal">
  <div class="modal-header">
    <span id="modal-title">Nový dokument</span>
    <span class="close-btn" onclick="closeModal()">X</span>
  </div>
  <div class="modal-body" id="modal-editor"></div>
</div>

<script>
const editor = document.getElementById('editor');
const modal = document.getElementById('modal');
const modalEditor = document.getElementById('modal-editor');
const modalTitle = document.getElementById('modal-title');

let currentDocId = null;

// Načtení uloženého textu při načtení stránky
window.onload = () => {
  const saved = localStorage.getItem('mainContent');
  if(saved) editor.innerHTML = saved;
};

// Automatické ukládání
editor.addEventListener('input', () => {
  if(editor.isContentEditable) saveText();
});
editor.addEventListener('keydown', handleKeys);

// Enter a Tab
function handleKeys(e) {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '<br><br>');
    saveText();
  }
  if(e.key === 'Tab') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    saveText();
  }
}

// Uložení
function saveText() {
  localStorage.setItem('mainContent', editor.innerHTML);
}

// Tajný edit mode
window.editmode = () => {
  editor.setAttribute('contenteditable', 'true');
};

// Klávesová zkratka Ctrl+E na zapnutí edit mode
document.addEventListener('keydown', (e) => {
  if(e.ctrlKey && e.key.toLowerCase() === 'e') {
    e.preventDefault();
    editmode();
  }
});

// Vložení kódu
function insertCode() {
  const target = (modal.style.display === "flex") ? modalEditor : editor;
  if(!target.isContentEditable) return;

  const code = prompt("Vlož sem svůj kód:");
  if(!code) return;
  const lines = code.split('\n');
  const lineNumbers = lines.map((_, i) => i + 1).join('<br>');
  const codeHTML = `
    <div class="code-block">
      <div class="line-numbers">${lineNumbers}</div>
      <div class="code-content">${lines.join('<br>')}</div>
    </div><br>
  `;
  target.innerHTML += codeHTML;

  if (target === editor) saveText();
  else if (currentDocId) localStorage.setItem(currentDocId, modalEditor.innerHTML);
}

// Vložení tlačítka pro dokument
function insertDocButton() {
  if(!editor.isContentEditable) return;
  const name = prompt("Zadej název tlačítka:", "Nový dokument");
  if (!name) return;
  const id = "doc_" + Date.now();
  const btn = `<button class="doc-btn" onclick="openModalEditor('${id}', '${name}')">${name}</button>`;
  editor.innerHTML += btn;
  saveText();
}

// Otevření modálního editoru
function openModalEditor(id, name) {
  currentDocId = id;
  modal.style.display = 'flex';
  modalTitle.textContent = name;

  const saved = localStorage.getItem(id);
  modalEditor.innerHTML = saved ? saved : "";

  modalEditor.contentEditable = editor.isContentEditable ? "true" : "false";

  modalEditor.oninput = () => {
    if(currentDocId && editor.isContentEditable) {
      localStorage.setItem(currentDocId, modalEditor.innerHTML);
    } else {
      const saved = localStorage.getItem(currentDocId);
      modalEditor.innerHTML = saved ? saved : "";
    }
  };

  modalEditor.onkeydown = (e) => {
    if(!editor.isContentEditable){
      e.preventDefault();
      return;
    }
    if(e.key === 'Enter') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '<br><br>');
    }
    if(e.key === 'Tab') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    }
  };
}

// Zavření modálního okna
function closeModal() {
  if(currentDocId && editor.isContentEditable) {
    localStorage.setItem(currentDocId, modalEditor.innerHTML);
    saveText();
  }
  modal.style.display = 'none';
  currentDocId = null;
}
</script>

</body>
</html>
