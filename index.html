<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coding Tutorial - FrCreator</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; background:#000; color:#fff; }
  .toolbar { background:#000; padding:10px; display:none; gap:5px; flex-wrap:wrap; color:#fff; }
  .toolbar button, .toolbar select { padding:5px; background:#000; color:#fff; border:2px solid #fff; border-radius:25px; }
  #editor { flex:1; padding:20px; border:none; outline:none; overflow-y:auto; background:#111; font-family:Arial, sans-serif; white-space:pre-wrap; color:#fff; }
  .code-block { background:#1e1e1e; color:#d4d4d4; font-family:'Courier New', monospace; padding:10px; display:flex; gap:10px; }
  .line-numbers { text-align:right; user-select:none; color:#888; }
  .code-content { white-space:pre; }
  .modal { display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; background:#111; border:2px solid #fff; z-index:1000; flex-direction:column; border-radius:25px; }
  .modal-header { background:#222; padding:5px; display:flex; justify-content:space-between; align-items:center; color:#fff; border-radius:30px; }
  .modal-body { flex:1; padding:10px; overflow-y:auto; border-top:1px solid #555; color:#fff; }
  .close-btn { cursor:pointer; font-weight:bold; }
  .doc-btn { padding:5px 10px; margin:5px; cursor:pointer; color:#fff; background:#000; border-radius:25px; }
</style>
</head>
<body>



<div id="editor" contenteditable="false"></div>

<div class="modal" id="modal">
  <div class="modal-header">
    <span id="modal-title">Nový dokument</span>
    <span class="close-btn" onclick="closeModal()">X</span>
  </div>
  <div class="modal-body" id="modal-editor"></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDGmaBUXKgFq1mPuSIi4_DY6xUycwNGnKE",
  authDomain: "textovy-dokument.firebaseapp.com",
  databaseURL: "https://textovy-dokument-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "textovy-dokument",
  storageBucket: "textovy-dokument.firebasestorage.app",
  messagingSenderId: "207844729713",
  appId: "1:207844729713:web:464c37fbde39a43aec0cd0",
  measurementId: "G-XS4PLS2G01"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const editor = document.getElementById('editor');
const toolbar = document.getElementById('toolbar');
const modal = document.getElementById('modal');
const modalEditor = document.getElementById('modal-editor');
const modalTitle = document.getElementById('modal-title');

let currentDocId = null;

// --- načtení hlavního obsahu z Firebase ---
db.ref('mainContent').on('value', snapshot => {
  if(!editor.isContentEditable){
    editor.innerHTML = snapshot.val() || "<p>Vítej v editoru! Stiskni Ctrl+E pro editaci.</p>";
  }
});

// --- načtení dokumentů z Firebase ---
function loadDocument(id) {
  db.ref('documents/' + id).on('value', snapshot => {
    if(currentDocId === id && !editor.isContentEditable) {
      modalEditor.innerHTML = snapshot.val() || "";
    }
  });
}

// Formátování
function format(command, value = null) {
  if(!editor.isContentEditable) return;
  document.execCommand(command, false, value);
  saveText();
}

// Ukládání hlavního editoru
editor.addEventListener('input', () => {
  if(editor.isContentEditable) saveText();
});
editor.addEventListener('keydown', handleKeys);

function handleKeys(e) {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '<br><br>');
    saveText();
  }
  if(e.key === 'Tab') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    saveText();
  }
}

function saveText() {
  db.ref('mainContent').set(editor.innerHTML);
}

// Otevření modálního editoru
function openModalEditor(id, name) {
  currentDocId = id;
  modal.style.display = 'flex';
  modalTitle.textContent = name;

  modalEditor.contentEditable = editor.isContentEditable ? "true" : "false";

  db.ref('documents/' + id).get().then(snapshot => {
    modalEditor.innerHTML = snapshot.exists() ? snapshot.val() : "";
  });

  // live update
  loadDocument(id);

  modalEditor.oninput = () => {
    if(currentDocId && editor.isContentEditable) {
      db.ref('documents/' + currentDocId).set(modalEditor.innerHTML);
    }
  };

  modalEditor.onkeydown = (e) => {
    if(!editor.isContentEditable){
      e.preventDefault();
      return;
    }
    if(e.key === 'Enter') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '<br><br>');
    }
    if(e.key === 'Tab') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    }
  };
}

function closeModal() {
  if(currentDocId && editor.isContentEditable) {
    db.ref('documents/' + currentDocId).set(modalEditor.innerHTML);
    saveText();
  }
  modal.style.display = 'none';
  currentDocId = null;
}
</script>
</body>
</html>
